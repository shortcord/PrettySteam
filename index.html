<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="chrome=1">
		<title>Pretty Steam</title>

		<link rel="stylesheet" href="css/core.min.css">
		<link rel="stylesheet" href="css/fonts.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<!--[if lt IE 9]>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<div class="wrapper">
			<header>
				<h1>Pretty Steam</h1>
				<p>Makes Steam look less crap<br><small>atleast in your web broser</small></p>
				<ul>
					<li style="width: 100%"><a target="_blank" href="https://github.com/teh-random-name/PrettySteam/blob/master/README.md"><strong>Get this</strong> on GitHub</a></li>
				</ul>
				<p><strong>This is constantly being worked on, images may be outdated.</strong></p>
			</header>
			<section>
				<figure class="cd-image-container">
					<img id="compareImageBefore" src="images/old-1.jpg" alt="Original Image">
					<span class="cd-image-label" data-type="original">Before</span>

					<div class="cd-resize-img"> <!-- the resizable image on top -->
						<img id="compareImageAfter" src="images/new-1.jpg" alt="Modified Image">
						<span class="cd-image-label" data-type="modified">After</span>
					</div>

					<span class="cd-handle"></span> <!-- slider handle -->
				</figure> <!-- cd-image-container -->
				<hr id="imageSpace">
				<div style="width: 100%;">
					<div style="width: 50%; margin: auto;">
						<ul style="width: 100%;">
							<li style="width:33%">
								<a class="cd-changeImage" 
								data-before="images/old-1.jpg" 
								data-after="images/new-1.jpg" 
								href="#"><strong>Profile</strong> (W/Background)</a>
							</li>
							<li style="width:33%">
								<a class="cd-changeImage" 
								data-before="images/old-2.jpg" 
								data-after="images/new-2.jpg" 
								href="#"><strong>Profile</strong> (Wout/Background)</a>
							</li>
							<li style="width:33%">
								<a class="cd-changeImage" 
								data-before="images/old-3.jpg" 
								data-after="images/new-3.jpg" 
								href="#"><strong>'More info'</strong> (W/Background)</a>
							</li>
						</ul>
					</div>
					<div id="smallScreen">
						<a target="_blank" href="https://github.com/teh-random-name/PrettySteam/blob/master/README.md"><strong>View</strong> on GitHub</a>
					</div>
				</div>
			</section>
			<footer>
				<p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
			</footer>
		</div>
	<script>
		$(document).ready(function(){
			$(".cd-changeImage").click(function(){
				var dBefore = $(this).data("before");
				var dAfter = $(this).data("after");

				$("#compareImageBefore").attr("src", dBefore);
				$("#compareImageAfter").attr("src", dAfter);
			});
		});
	</script>
	<script>
		var metas = document.getElementsByTagName('meta');
		var i;
		if (navigator.userAgent.match(/iPhone/i)) {
			for (i=0; i<metas.length; i++) {
				if (metas[i].name == "viewport") {
					metas[i].content = "width=device-width, minimum-scale=1.0, maximum-scale=1.0";
				}
			}
		document.addEventListener("gesturestart", gestureStart, false);
		}
		function gestureStart() {
			for (i=0; i<metas.length; i++) {
				if (metas[i].name == "viewport") {
					metas[i].content = "width=device-width, minimum-scale=0.25, maximum-scale=1.6";
				}
			}
		}
	</script>
	<script>
		jQuery(document).ready(function($){
			//make the .cd-handle element draggable and modify .cd-resize-img width according to its position
			$('.cd-image-container').each(function(){
				var actual = $(this);
				drags(actual.find('.cd-handle'), actual.find('.cd-resize-img'), actual, actual.find('.cd-image-label[data-type="original"]'), actual.find('.cd-image-label[data-type="modified"]'));
			});
			
			//check if the .cd-image-container is in the viewport 
			//if yes, animate it
			checkPosition($('.cd-image-container'));
			$(window).on('scroll', function(){
				checkPosition($('.cd-image-container'));
			});

			//upadate images label visibility
			$(window).on('resize', function(){
				$('.cd-image-container').each(function(){
					var actual = $(this);
					updateLabel(actual.find('.cd-image-label[data-type="modified"]'), actual.find('.cd-resize-img'), 'left');
					updateLabel(actual.find('.cd-image-label[data-type="original"]'), actual.find('.cd-resize-img'), 'right');
				});
			});
		});

		function checkPosition(container) {
			container.each(function(){
				var actualContainer = $(this);
				if( $(window).scrollTop() + $(window).height()*0.5 > actualContainer.offset().top) {
					actualContainer.addClass('is-visible');
				}
			});
		}

		//draggable funtionality - credits to http://css-tricks.com/snippets/jquery/draggable-without-jquery-ui/
		function drags(dragElement, resizeElement, container, labelContainer, labelResizeElement) {
			dragElement.on("mousedown vmousedown", function(e) {
				dragElement.addClass('draggable');
				resizeElement.addClass('resizable');

				var dragWidth = dragElement.outerWidth(),
					xPosition = dragElement.offset().left + dragWidth - e.pageX,
					containerOffset = container.offset().left,
					containerWidth = container.outerWidth(),
					minLeft = containerOffset + 10,
					maxLeft = containerOffset + containerWidth - dragWidth - 10;

				dragElement.parents().on("mousemove vmousemove", function(e) {
					leftValue = e.pageX + xPosition - dragWidth;

					//constrain the draggable element to move inside his container
					if(leftValue < minLeft ) {
						leftValue = minLeft;
					} else if ( leftValue > maxLeft) {
						leftValue = maxLeft;
					}

					widthValue = (leftValue + dragWidth/2 - containerOffset)*100/containerWidth+'%';

					$('.draggable').css('left', widthValue).on("mouseup vmouseup", function() {
						$(this).removeClass('draggable');
						resizeElement.removeClass('resizable');
					});

					$('.resizable').css('width', widthValue); 

					updateLabel(labelResizeElement, resizeElement, 'left');
					updateLabel(labelContainer, resizeElement, 'right');

				}).on("mouseup vmouseup", function(e){
					dragElement.removeClass('draggable');
					resizeElement.removeClass('resizable');
				});
				e.preventDefault();
			}).on("mouseup vmouseup", function(e) {
				dragElement.removeClass('draggable');
				resizeElement.removeClass('resizable');
			});
		}

		function updateLabel(label, resizeElement, position) {
			if(position == 'left') {
				( label.offset().left + label.outerWidth() < resizeElement.offset().left + resizeElement.outerWidth() ) ? label.removeClass('is-hidden') : label.addClass('is-hidden') ;
			} else {
				( label.offset().left > resizeElement.offset().left + resizeElement.outerWidth() ) ? label.removeClass('is-hidden') : label.addClass('is-hidden') ;
			}
		}
	</script>
	</body>
</html>
